import 'package:device_control/device/device_base.dart';
import 'package:device_control/device/io_subscription.dart';
import 'package:flutter/widgets.dart';

class IoBase 
{
  final Map<State, IoSubscription> _subscriptions = {};
  String name = '';
  String deviceId = '';
  dynamic _value = null;


  void subscribe(State state, IoSubscription subscription) 
  {
    _subscriptions[state] = subscription;
  }

  void unsubscribe(State state) 
  {
    _subscriptions.remove(state);
  }

  void notifySubscribers() 
  {
    _subscriptions.forEach
    (
      (key, value) 
      {
        if (key.mounted ) 
        {
          key.setState((){});
        }
      }
    );
  }

  dynamic get value => _value;

  set value(dynamic value) 
  {
    _value = value;
    notifySubscribers();
  }

}

abstract class NotifyState<T extends StatefulWidget> extends State<T> 
{
  DeviceBase? device;
  dynamic ioState;

  void notifyChange(DeviceBase device,dynamic ioState) 
  {
    if (this.mounted)
    {
    this.device = device;
    this.ioState = ioState;
    setState((){});
    }
  }
}